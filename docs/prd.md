# 消防器材点检管理系统 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 项目背景
传统的消防器材管理依赖纸质表格进行点检记录，存在易丢失、难追溯、查询统计效率低下、无法实时监控等问题。为了提升消防安全管理的数字化水平和效率，我们计划开发一套基于手机网页扫码和电脑端后台管理的消防器材点检系统。

### 1.2 产品目标
*   **目标一：流程无纸化与数据追溯。** 替代传统的纸质点检作业，实现点检流程的全面无纸化。所有点检数据将被电子化存储，方便长期保存、快速查询和历史追溯。
*   **目标二：确保点检合规与及时响应。** 通过系统化的提醒与追踪机制，确保所有消防器材都能被100%按时点检，杜绝漏检。对点检过程中发现的异常状态（如过期、损坏、压力不足等）能进行及时上报和闭环处理。
*   **目标三：支持管理决策。** 为管理层提供一个集中化的管理平台，能够实时监控各厂区的消防器材状态。通过多维度的数据分析和报表，为消防安全管理决策提供有力的数据支持。

## 2. 用户角色与职责 (User Persona)

本系统主要包含以下三类用户角色：

| 角色名称 | 核心职责 | 主要使用端 |
| :--- | :--- | :--- |
| **一线点检员** | 使用手机网页端，通过扫码执行具体的消防器材点检任务，并上报异常情况。 | 手机网页端 |
| **厂区安全管理员** | 管理本厂区的消防器材台账、点检任务、用户账号；处理点检员上报的异常；查看和导出本厂区的数据报表。 | 电脑端 |
| **系统超级管理员** | 拥有系统的最高权限，负责创建和管理所有厂区信息、用户账号和角色权限；查看全集团的综合数据报表；进行系统级的配置。 | 电脑端 |

## 3. 功能模块规划 (Functional Modules)

### 3.1 手机网页端 (专为“一线点检员”设计)

| 功能模块 | 功能描述 | 优先级 |
| :--- | :--- | :--- |
| **用户登录** | 点检员使用自己的账号和密码登录系统。 | 高 |
| **扫码点检** | - 点击主界面的“扫码点检”按钮，调用手机摄像头进行扫码。<br>- 扫描消防器材上的二维码后，进入点检详情页。 | 高 |
| **点检信息展示** | - 扫描成功后，页面自动展示该器材的关键信息：<br>  - 器材编号<br>  - 器材类型 (如：手提式干粉灭火器)<br>  - 所在位置<br>  - 上次点检日期和点检人<br>  - 规格型号 | 高 |
| **执行点检** | - 页面加载该类型器材对应的**点检项列表** (该列表由管理员在后台配置)。<br>- 每个点检项提供“正常”和“异常”两个选项。<br>- 必须上传一张**点检照片** (例如，器材和周围环境的全貌照)，作为现场点检的凭证。<br>- 所有点检项检查完毕且照片上传后，方可提交。 | 高 |
| **异常上报** | - 如果某个点检项选择“异常”，则**必须**补充以下信息：<br>  - **问题图片**：强制要求拍摄异常部位的特写照片。<br>  - **原因描述**：一个文本框，用于填写异常的具体情况描述。 | 高 |
| **提交与反馈** | - 点击“提交”后，系统记录本次点检结果，并更新器材状态。<br>- 如果存在异常，系统自动在后台创建一张“隐患整改通知单”，并推送给对应的厂区安全管理员。 | 高 |

### 3.2 电脑管理端 (为“厂区安全管理员”和“系统超级管理员”设计)

| 功能模块 | 功能描述 | 权限说明 | 优先级 |
| :--- | :--- | :--- | :--- |
| **数据看板 (Dashboard)** | - 以图表形式展示核心数据：器材完好率、待处理隐患数、本月点检完成率、各类型器材数量统计等。<br>- 超级管理员看到的是全集团数据，厂区管理员仅看到本厂区数据。 | 超级管理员, 厂区安全管理员 | 高 |
| **器材管理** | - **器材台账**：录入、修改、查询、删除消防器材信息 (编号, 类型, 规格, 生产日期, 位置等)。<br>- **批量导入/导出**：支持通过Excel模板批量导入和导出器材台账。<br>- **二维码生成与打印**：系统为每个器材生成唯一的二维码，并支持批量导出打印。 | 超级管理员, 厂区安全管理员 | 高 |
| **点检项配置** | - **器材类型管理**：超级管理员可以定义不同的器材类型 (如：消火栓、手提式干粉灭火器等)。<br>- **检查标准设置**：针对每种器材类型，可以自定义需要检查的点检项列表。 | 超级管理员 | 高 |
| **点检记录查询** | - 按时间、厂区、器材编号、点检人、点检结果(正常/异常)等多种条件筛选和查询所有点检历史记录。<br>- 查看每次点检的详细信息，包括所有照片和文字描述。<br>- 支持将查询结果导出为Excel。 | 超级管理员, 厂区安全管理员 | 高 |
| **隐患管理与整改** | - **隐患列表**：集中展示所有状态为“待处理”的隐患通知单。<br>- **流程处理**：厂区管理员收到通知单后，进行线下整改，完成后在系统中上传**整改后照片**和**处理说明**，并提交。<br>- **审核闭环**：厂区管理员提交整改后，系统将通知单流转给**系统超级管理员**进行**审核**。审核通过后，该隐患状态变为“已关闭”，形成闭环管理。审核不通过则退回给厂区管理员重新处理。 | 超级管理员, 厂区安全管理员 | 高 |
| **报表中心** | - **月度点检报告**：自动生成各厂区的月度点检覆盖率、异常率等报告。<br>- **器材状态报告**：按需生成即将过期或报废的器材清单。<br>- 所有报表支持在线预览和导出。 | 超级管理员, 厂区安全管理员 | 高 |
| **多厂区/用户管理** | - **厂区管理**：超级管理员创建、编辑不同的厂区。<br>- **用户管理**：超级管理员创建用户账号，并为其分配角色（点检员/厂区管理员）和所属厂区。 | 超级管理员 | 高 |

## 4. 非功能性需求 (Non-Functional Requirements)

| 类别 | 需求描述 |
| :--- | :--- |
| **数据库** | - **初期选型**：使用 **SQLite3** 作为后端数据库，以简化部署和配置。<br>- **设计考虑**：系统架构设计应考虑解耦，以便未来在业务规模扩大时，可以平滑地将数据库迁移至MySQL、PostgreSQL等性能更强的关系型数据库。<br>- **数据结构**：所有厂区的数据统一存储在一个数据库文件中，通过应用层的逻辑来划分和展示数据权限。 |
| **性能需求** | - **页面加载**：主要操作页面（特别是手机端的登录页和扫码后的点检页）应在3秒内完成加载。<br>- **并发性能**：系统应能支持至少20个用户的并发访问，不出现明显延迟或卡顿。 |
| **安全性需求** | - **密码安全**：所有用户的登录密码必须经过加密处理（如哈希加盐）后才能存储在数据库中，严禁明文存储。<br>- **防注入攻击**：所有接收用户输入的接口都必须进行严格的参数校验和过滤，以防止SQL注入、XSS跨站脚本等常见的Web攻击。<br>- **权限控制**：严格遵循基于角色的访问控制（RBAC）。用户只能访问其角色权限范围内的功能和数据。例如，A厂区的管理员不能查看或操作B厂区的任何数据。 |
| **可用性需求** | - **界面设计**：手机网页端界面应简洁明了，按钮和字体大小适中，易于户外单手操作。<br>- **二维码兼容性**：系统应能识别常规光照、轻微反光或略有磨损情况下的二维码。 |
| **部署与维护** | - **技术栈**：推荐使用轻量级的后端框架（如Python的Flask或FastAPI）和前端技术（如Vue.js或纯HTML/CSS/JS），便于快速开发和部署。 |

## 5. 核心数据表结构 (Data Schema)

以下是推荐的核心数据表结构，基于SQLite3设计，同时兼容向MySQL等数据库的迁移。

**1. 厂区表 (factories)**
> 存储厂区信息

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `name` | TEXT | 厂区名称 (如：A厂区) |
| `address` | TEXT | 厂区地址 (可选) |
| `created_at` | DATETIME | 创建时间 |

**2. 用户表 (users)**
> 存储用户信息和权限

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `username` | TEXT | 用户名 (登录账号) |
| `password_hash` | TEXT | 加密后的密码 |
| `full_name` | TEXT | 用户姓名 |
| `role` | TEXT | 角色 ('点检员', '厂区管理员', '超级管理员') |
| `factory_id` | INTEGER | 所属厂区ID (外键, 关联factories.id) |
| `is_active` | BOOLEAN | 账号是否激活 |
| `created_at` | DATETIME | 创建时间 |

**3. 器材类型表 (equipment_types)**
> 存储器材的种类，方便统一管理和配置

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `name` | TEXT | 类型名称 (如：手提式干粉灭火器) |

**4. 点检项模板表 (checklist_templates)**
> 存储每种器材类型需要检查的项目

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `type_id` | INTEGER | 关联的器材类型ID (外键, 关联equipment_types.id) |
| `item_name` | TEXT | 检查项名称 (如：压力表指针是否在绿区) |
| `sort_order` | INTEGER | 显示顺序 |

**5. 消防器材表 (equipments)**
> 核心的消防器材台账

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `qr_code` | TEXT | 唯一标识，用于生成二维码 |
| `name` | TEXT | 器材自定义名称/编号 |
| `type_id` | INTEGER | 器材类型ID (外键, 关联equipment_types.id) |
| `factory_id` | INTEGER | 所属厂区ID (外键, 关联factories.id) |
| `location` | TEXT | 具体存放位置 |
| `specifications` | TEXT | 规格型号 (如：MF/ABC5) |
| `production_date` | DATE | **生产日期** |
| `expiry_date` | DATE | **有效截止日期** |
| `status` | TEXT | 当前状态 ('正常', '异常', '报废') |
| `last_inspected_at` | DATETIME | 上次点检时间 |

**6. 隐患处理表 (issues)**
> 存储异常上报及整改流程的记录

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `equipment_id` | INTEGER | 关联的器材ID (外键, 关联equipments.id) |
| `description` | TEXT | 隐患问题描述 |
| `reporter_id` | INTEGER | 上报人ID (外键, 关联users.id) |
| `issue_image_url` | TEXT | 隐患照片存放路径 |
| `status` | TEXT | 状态 ('待处理', '待审核', '已关闭') |
| `created_at` | DATETIME | 隐患创建时间 |
| `handler_id` | INTEGER | 整改处理人ID (外键, 关联users.id) |
| `handled_at` | DATETIME | 整改完成时间 |
| `solution` | TEXT | 整改措施说明 |
| `fixed_image_url` | TEXT | 整改后照片路径 |
| `auditor_id` | INTEGER | 审核人ID (外键, 关联users.id) |
| `audited_at` | DATETIME | 审核时间 |

**7. 点检记录表 (inspection_logs)**
> 存储每一次的点检操作记录，关联到具体的隐患（如果存在）

| 字段名 | 数据类型 | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主键，自增 |
| `equipment_id` | INTEGER | 关联的器材ID (外键, 关联equipments.id) |
| `inspector_id` | INTEGER | 点检员ID (外键, 关联users.id) |
| `overall_result` | TEXT | 本次综合结果 ('正常', '异常') |
| `inspection_image_url` | TEXT | 点检现场照片路径 |
| `inspection_time` | DATETIME | 点检时间 |
| `issue_id` | INTEGER | 如果结果为异常，关联的隐患ID (外键, 关联issues.id) |