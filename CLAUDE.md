# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ”¥ é¡¹ç›®æ¦‚è¿°

æ¶ˆé˜²å™¨æç‚¹æ£€ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºReact + Node.jsçš„ç°ä»£åŒ–æ¶ˆé˜²å®‰å…¨ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨å‰åç«¯é›†æˆéƒ¨ç½²æ¶æ„ã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React 19 + TypeScript + Vite + Tailwind CSS + shadcn/ui + Zustand
- **åç«¯**: Node.js 18+ + Express.js + Prisma ORM + SQLite3
- **éƒ¨ç½²**: PM2 è¿›ç¨‹ç®¡ç† + é›†æˆéƒ¨ç½²æ¨¡å¼

## ğŸš€ å¼€å‘å‘½ä»¤

### å¿«é€Ÿå¯åŠ¨
```bash
# ä¸€é”®éƒ¨ç½² (Windows)
deploy.bat

# ä¸€é”®éƒ¨ç½² (Linux/macOS)
chmod +x deploy.sh && ./deploy.sh

# å¼€å‘æ¨¡å¼åˆå§‹åŒ–
cd backend && npm run setup
```

### å‰ç«¯å¼€å‘
```bash
cd frontend
npm install
npm run dev        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build      # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run lint       # ä»£ç æ£€æŸ¥
```

### åç«¯å¼€å‘
```bash
cd backend
npm install
npm run dev        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (nodemon)
npm start          # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm test           # è¿è¡ŒAPIæµ‹è¯•
npm run test:security  # å®‰å…¨æµ‹è¯•
```

### æ•°æ®åº“ç®¡ç†
```bash
cd backend
npm run db:generate     # ç”ŸæˆPrismaå®¢æˆ·ç«¯
npm run db:push         # åŒæ­¥æ•°æ®åº“ç»“æ„
npm run db:seed         # å¡«å……ç§å­æ•°æ®
npm run db:studio       # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
npm run db:setup        # å®Œæ•´æ•°æ®åº“åˆå§‹åŒ–
```

### ç”Ÿäº§ç¯å¢ƒç®¡ç†
```bash
cd backend
pm2 status              # æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 logs                # æŸ¥çœ‹æ—¥å¿—
pm2 restart all         # é‡å¯åº”ç”¨
pm2 stop all            # åœæ­¢åº”ç”¨
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### éƒ¨ç½²æ¶æ„
- **é›†æˆéƒ¨ç½²æ¨¡å¼**: åç«¯æœåŠ¡å™¨åŒæ—¶æä¾›APIæœåŠ¡å’Œå‰ç«¯é™æ€æ–‡ä»¶æ‰˜ç®¡
- **å•ä¸€ç«¯å£è®¿é—®**: æ‰€æœ‰è¯·æ±‚é€šè¿‡3001ç«¯å£ï¼ŒAPIè·¯ç”±åœ¨/api/*ï¼Œå‰ç«¯è·¯ç”±åœ¨æ ¹è·¯å¾„
- **è·¨å¹³å°æ”¯æŒ**: Windows/Linux/macOSå…¨å¹³å°å…¼å®¹

### ç›®å½•ç»“æ„
```
â”œâ”€â”€ backend/                # åç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ controllers/   # æ§åˆ¶å™¨ (ä¸šåŠ¡é€»è¾‘)
â”‚   â”‚   â”œâ”€â”€ services/      # æœåŠ¡å±‚ (æ•°æ®å¤„ç†)
â”‚   â”‚   â”œâ”€â”€ routes/        # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ middleware/    # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ security/      # å®‰å…¨æ¨¡å—
â”‚   â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ prisma/            # æ•°æ®åº“æ¨¡å‹å’Œè¿ç§»
â”‚   â”œâ”€â”€ uploads/           # æ–‡ä»¶ä¸Šä¼ å­˜å‚¨
â”‚   â””â”€â”€ public/            # å‰ç«¯æ„å»ºæ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ frontend/              # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/        # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/           # APIæ¥å£å±‚
â”‚   â”‚   â””â”€â”€ types/         # TypeScriptç±»å‹
â”‚   â””â”€â”€ dist/              # æ„å»ºè¾“å‡º (éƒ¨ç½²æ—¶å¤åˆ¶åˆ°backend/public)
â””â”€â”€ docs/                  # æ–‡æ¡£ç›®å½•
```

### æ ¸å¿ƒæ¨¡å—

#### æ•°æ®æ¨¡å‹ (backend/prisma/schema.prisma)
- `User`: ç”¨æˆ·ç³»ç»Ÿ (è¶…çº§ç®¡ç†å‘˜/å‚åŒºç®¡ç†å‘˜/ç‚¹æ£€å‘˜)
- `Factory`: å‚åŒºç®¡ç†
- `Equipment`: æ¶ˆé˜²å™¨æå°è´¦
- `EquipmentType` + `ChecklistTemplate`: å™¨æç±»å‹å’Œæ£€æŸ¥é¡¹æ¨¡æ¿
- `InspectionLog`: ç‚¹æ£€è®°å½•
- `Issue`: éšæ‚£å¤„ç†æµç¨‹

#### APIè·¯ç”±æ¨¡å— (backend/src/routes/)
- `auth.routes.js`: èº«ä»½è®¤è¯ (ç™»å½•/åˆ·æ–°ä»¤ç‰Œ)
- `equipment.routes.js`: å™¨æç®¡ç† (CRUD + äºŒç»´ç ç”Ÿæˆ)
- `inspection.routes.js`: ç‚¹æ£€æµç¨‹ (æ‰«ç ç‚¹æ£€ + è®°å½•æŸ¥è¯¢)
- `issue.routes.js`: éšæ‚£ç®¡ç† (ä¸ŠæŠ¥ + å¤„ç† + å®¡æ ¸)
- `user.routes.js`: ç”¨æˆ·ç®¡ç† (è§’è‰²æƒé™)
- `report.routes.js`: æ•°æ®æŠ¥è¡¨ (ç»Ÿè®¡åˆ†æ)

#### å®‰å…¨æ¨¡å— (backend/src/security/)
- `security-config.js`: æ•´ä½“å®‰å…¨é…ç½® (CORS + Helmet + é™æµ)
- `auth.middleware.js`: JWTè®¤è¯ä¸­é—´ä»¶
- `rate-limiter.js`: APIé™æµ
- `file-upload.js`: æ–‡ä»¶ä¸Šä¼ å®‰å…¨è¿‡æ»¤
- `input-validator.js`: è¾“å…¥éªŒè¯
- `audit-logger.js`: æ“ä½œå®¡è®¡æ—¥å¿—

#### å‰ç«¯é¡µé¢ç»„ä»¶ (frontend/src/pages/)
- `LoginPage.tsx`: ç™»å½•é¡µé¢
- `DashboardPage.tsx`: PCç«¯ç®¡ç†åå°
- `mobile/MobileDashboard.tsx`: ç§»åŠ¨ç«¯é¦–é¡µ
- `mobile/MobileInspectionPage.tsx`: ç§»åŠ¨ç«¯ç‚¹æ£€é¡µé¢

## ğŸ” æƒé™ç³»ç»Ÿ

### ç”¨æˆ·è§’è‰²
- **SUPER_ADMIN**: è¶…çº§ç®¡ç†å‘˜ (ç³»ç»Ÿå…¨å±€ç®¡ç†)
- **FACTORY_ADMIN**: å‚åŒºç®¡ç†å‘˜ (æ‰€å±å‚åŒºç®¡ç†)
- **INSPECTOR**: ç‚¹æ£€å‘˜ (æ‰«ç ç‚¹æ£€)

### æ•°æ®éš”ç¦»
- åŸºäº`factoryId`å®ç°å‚åŒºçº§æ•°æ®éš”ç¦»
- è¶…çº§ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰å‚åŒºæ•°æ®
- å‚åŒºç®¡ç†å‘˜åªèƒ½è®¿é—®æ‰€å±å‚åŒºæ•°æ®
- ç‚¹æ£€å‘˜åªèƒ½è¿›è¡Œç‚¹æ£€æ“ä½œ

### è®¤è¯æµç¨‹
1. ç”¨æˆ·ç™»å½•è·å–JWTè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ
2. APIè¯·æ±‚éœ€æºå¸¦Authorization: Bearer <token>
3. ä»¤ç‰Œè¿‡æœŸæ—¶ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ

## ğŸ“± åŠŸèƒ½ç‰¹æ€§

### ç§»åŠ¨ç«¯åŠŸèƒ½
- æ‰«ç ç‚¹æ£€: è°ƒç”¨html5-qrcodeæ‰«æå™¨æäºŒç»´ç 
- åŠ¨æ€è¡¨å•: æ ¹æ®å™¨æç±»å‹åŠ è½½æ£€æŸ¥é¡¹æ¨¡æ¿
- å¼‚å¸¸ä¸ŠæŠ¥: å‘ç°é—®é¢˜æ—¶æ‹ç…§ä¸Šä¼ å’Œæè¿°

### PCç«¯ç®¡ç†
- å®æ—¶çœ‹æ¿: å™¨æçŠ¶æ€ç»Ÿè®¡ã€ç‚¹æ£€è¿›åº¦ã€éšæ‚£æ•°é‡
- å™¨æç®¡ç†: å°è´¦ç®¡ç†ã€äºŒç»´ç æ‰¹é‡ç”Ÿæˆã€Excelå¯¼å…¥
- éšæ‚£ç®¡ç†: å¤„ç†æµç¨‹(å¾…å¤„ç†â†’å¤„ç†ä¸­â†’å¾…å®¡æ ¸â†’å·²å…³é—­)
- æ•°æ®æŠ¥è¡¨: æœˆåº¦ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æã€å¯¼å‡ºåŠŸèƒ½

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—
1. **æ•°æ®æ¨¡å‹**: åœ¨`prisma/schema.prisma`ä¸­å®šä¹‰æ–°è¡¨ç»“æ„
2. **æ•°æ®åº“åŒæ­¥**: è¿è¡Œ`npm run db:push`åº”ç”¨ç»“æ„å˜æ›´
3. **APIå±‚**: åœ¨`src/routes/`åˆ›å»ºè·¯ç”±æ–‡ä»¶
4. **æœåŠ¡å±‚**: åœ¨`src/services/`åˆ›å»ºä¸šåŠ¡é€»è¾‘
5. **æ§åˆ¶å™¨**: åœ¨`src/controllers/`åˆ›å»ºæ§åˆ¶å™¨
6. **å‰ç«¯æ¥å£**: åœ¨`frontend/src/api/`å®šä¹‰APIè°ƒç”¨
7. **é¡µé¢ç»„ä»¶**: åœ¨`frontend/src/pages/`åˆ›å»ºé¡µé¢
8. **æƒé™éªŒè¯**: ç¡®ä¿æ·»åŠ é€‚å½“çš„è§’è‰²æƒé™æ£€æŸ¥

### ä»£ç é£æ ¼
- åç«¯: Express.jsæ ‡å‡†æ¨¡å¼ï¼Œé‡‡ç”¨æ¨¡å—åŒ–ç»“æ„
- å‰ç«¯: Reactå‡½æ•°å¼ç»„ä»¶ + TypeScript + Hooks
- æ•°æ®åº“: Prisma ORMï¼Œç±»å‹å®‰å…¨çš„æ•°æ®è®¿é—®
- å®‰å…¨: æ‰€æœ‰APIéƒ½éœ€è¦è®¤è¯å’Œæƒé™éªŒè¯

### è°ƒè¯•å’Œæµ‹è¯•
- åç«¯APIæµ‹è¯•: `npm run test:api`
- å®‰å…¨æµ‹è¯•: `npm run test:security`
- æ•°æ®åº“ç®¡ç†: `npm run db:studio`
- æ—¥å¿—æŸ¥çœ‹: PM2æ—¥å¿—åœ¨`backend/logs/`ç›®å½•

### ç¯å¢ƒé…ç½®
ä¸»è¦é…ç½®åœ¨`backend/.env`æ–‡ä»¶:
- DATABASE_URL: SQLiteæ•°æ®åº“æ–‡ä»¶è·¯å¾„
- JWT_SECRET: JWTç­¾åå¯†é’¥
- PORT: æœåŠ¡ç«¯å£ (é»˜è®¤3001)
- UPLOAD_DIR: æ–‡ä»¶ä¸Šä¼ ç›®å½•

## ğŸ“Š é»˜è®¤æµ‹è¯•è´¦æˆ·

| è§’è‰² | ç”¨æˆ·å | å¯†ç  | æƒé™èŒƒå›´ |
|------|--------|------|----------|
| è¶…çº§ç®¡ç†å‘˜ | admin | Test123!@# | å…¨ç³»ç»Ÿç®¡ç† |
| Aå‚åŒºç®¡ç†å‘˜ | admin_a | Test123!@# | Aå‚åŒºç®¡ç† |
| Bå‚åŒºç®¡ç†å‘˜ | admin_b | Test123!@# | Bå‚åŒºç®¡ç† |
| Cå‚åŒºç®¡ç†å‘˜ | admin_c | Test123!@# | Cå‚åŒºç®¡ç† |
| ç‚¹æ£€å‘˜ | inspector_001~004 | Test123!@# | æ‰«ç ç‚¹æ£€ |

## ğŸš¦ å¸¸è§é—®é¢˜

### éƒ¨ç½²ç›¸å…³
- ç¡®ä¿Node.jsç‰ˆæœ¬ >= 18.0.0
- Windowsç”¨æˆ·è¿è¡Œ`deploy.bat`ï¼ŒLinux/macOSè¿è¡Œ`deploy.sh`
- æ•°æ®åº“æ–‡ä»¶ä½äº`backend/data/fire_safety.db`
- ä¸Šä¼ æ–‡ä»¶å­˜å‚¨åœ¨`backend/uploads/`

### å¼€å‘ç›¸å…³
- å‰ç«¯å¼€å‘æœåŠ¡å™¨: http://localhost:5173
- åç«¯APIæœåŠ¡å™¨: http://localhost:3001
- æ•°æ®åº“ç®¡ç†ç•Œé¢: http://localhost:5555 (è¿è¡Œdb:studioæ—¶)
- APIæ–‡æ¡£è¯¦è§: `backend/API_DOCUMENTATION.md`

### ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹ï¼Œæ”¯æŒè‡ªåŠ¨é‡å¯å’Œè´Ÿè½½å‡è¡¡
- æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨æ»šåŠ¨ï¼Œä½äº`backend/logs/`
- æ”¯æŒé›†ç¾¤æ¨¡å¼éƒ¨ç½²ä»¥æé«˜æ€§èƒ½